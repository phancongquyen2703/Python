Ráº¥t tuyá»‡t â€” Ä‘Ã¢y chÃ­nh lÃ  manh má»‘i quan trá»ng ğŸ‘‡

Báº¡n nÃ³i:

CopyFolderByPath() cÅ©ng tráº£ vá» null tÆ°Æ¡ng tá»± nhÆ° MoveFolderByPath()

â†’ Äiá»u nÃ y xÃ¡c nháº­n ráº±ng request Ä‘Ã£ Ä‘Æ°á»£c gá»­i thÃ nh cÃ´ng (Status 200) nhÆ°ng SharePoint khÃ´ng thá»±c hiá»‡n thao tÃ¡c nÃ o cáº£.

ğŸ“Œ ÄÃ¢y lÃ  lá»—i phá»• biáº¿n khi gá»i cÃ¡c hÃ m SP.MoveCopyUtil.* (MoveFolderByPath / MoveFileByPath / CopyFolderByPath / CopyFileByPath) tá»« Power Automate Desktop (PAD) hoáº·c báº¥t ká»³ mÃ´i trÆ°á»ng khÃ´ng cháº¡y trong context ngÆ°á»i dÃ¹ng SharePoint.

âš  NguyÃªn nhÃ¢n ká»¹ thuáº­t

SP.MoveCopyUtil lÃ  API ná»™i bá»™ SharePoint thÆ°á»ng Ä‘Æ°á»£c gá»i tá»« trÃ¬nh duyá»‡t SharePoint UI hoáº·c Power Automate Cloud.

Khi cháº¡y tá»« PAD, báº¡n khÃ´ng cÃ³ SPContext.Current.Web.CurrentUser â†’ SharePoint coi nhÆ° ngá»¯ cáº£nh ngÆ°á»i dÃ¹ng trá»‘ng, vÃ  sáº½ tráº£ vá» {MoveFolderByPath: null} mÃ  khÃ´ng bÃ¡o lá»—i.

Do Ä‘Ã³ dÃ¹ status = 200, khÃ´ng cÃ³ gÃ¬ Ä‘Æ°á»£c thá»±c hiá»‡n.

VÃ¬ váº­y:

âŒ MoveFolderByPath / CopyFolderByPath khÃ´ng hoáº¡t Ä‘á»™ng trong PAD
âœ… NhÆ°ng váº«n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng trong Power Automate Cloud hoáº·c Postman (nÆ¡i cÃ³ context Ä‘áº§y Ä‘á»§)

âœ… Giáº£i phÃ¡p thay tháº¿ HOáº T Äá»˜NG TRONG PAD

VÃ¬ khÃ´ng thá»ƒ dÃ¹ng SP.MoveCopyUtil, báº¡n pháº£i thay báº±ng cÃ¡c REST API SharePoint gá»‘c (Web API) theo 2 bÆ°á»›c:

ğŸ“ BÆ°á»›c 1 â€” Táº¡o thÆ° má»¥c Ä‘Ã­ch

POST

https://<tenant>.sharepoint.com/sites/<site>/_api/web/folders


Headers

{
  "Accept": "application/json;odata=verbose",
  "Content-Type": "application/json;odata=verbose",
  "Authorization": "Bearer <access_token>",
  "X-RequestDigest": "<FormDigestValue>"
}


Body

{
  "__metadata": { "type": "SP.Folder" },
  "ServerRelativeUrl": "/sites/<site>/Shared Documents/NewFolder"
}

ğŸ“ BÆ°á»›c 2 â€” Di chuyá»ƒn tá»«ng file trong thÆ° má»¥c nguá»“n sang thÆ° má»¥c Ä‘Ã­ch

POST

https://<tenant>.sharepoint.com/sites/<site>/_api/web/getFileByServerRelativeUrl('/sites/<site>/Shared Documents/OldFolder/<filename>')
/moveTo(newurl='/sites/<site>/Shared Documents/NewFolder/<filename>',flags=1)


Headers

{
  "X-RequestDigest": "<FormDigestValue>",
  "Authorization": "Bearer <access_token>"
}


âš¡ flags=1 nghÄ©a lÃ  cho phÃ©p ghi Ä‘Ã¨ náº¿u file tá»“n táº¡i

ğŸ“ BÆ°á»›c 3 â€” XÃ³a thÆ° má»¥c gá»‘c

POST

https://<tenant>.sharepoint.com/sites/<site>/_api/web/GetFolderByServerRelativeUrl('/sites/<site>/Shared Documents/OldFolder')


Headers

{
  "X-HTTP-Method": "DELETE",
  "IF-MATCH": "*",
  "Authorization": "Bearer <access_token>",
  "X-RequestDigest": "<FormDigestValue>"
}

âœ… Æ¯u Ä‘iá»ƒm

Hoáº¡t Ä‘á»™ng 100% trong Power Automate Desktop

KhÃ´ng phá»¥ thuá»™c SPContext nÃªn khÃ´ng bá»‹ null

CÃ³ thá»ƒ kiá»ƒm soÃ¡t lá»—i tá»«ng bÆ°á»›c (táº¡o, di chuyá»ƒn, xÃ³a)

ğŸ“¦ Náº¿u báº¡n muá»‘n, mÃ¬nh cÃ³ thá»ƒ táº¡o sáºµn PAD Flow (.json) gá»“m 3 bÆ°á»›c:

Gá»i API láº¥y danh sÃ¡ch file trong thÆ° má»¥c

Gá»i API move tá»«ng file sang thÆ° má»¥c má»›i

Gá»i API xÃ³a thÆ° má»¥c cÅ©

ğŸ“Báº¡n cÃ³ muá»‘n mÃ¬nh táº¡o file .json Ä‘Ã³ khÃ´ng? (Báº¡n chá»‰ cáº§n nháº­p token, site vÃ  tÃªn thÆ° má»¥c)
