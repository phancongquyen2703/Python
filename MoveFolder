Move Folder
📌 Các bước thực hiện trong PAD
🅐 Bước 1 — Gọi Azure AD lấy Access Token

HTTP POST

https://accounts.accesscontrol.windows.net/<tenant-id>/tokens/OAuth/2


Body (x-www-form-urlencoded):

grant_type=client_credentials
&client_id=<appId>@<tenantId>
&client_secret=<secret>
&resource=00000003-0000-0ff1-ce00-000000000000/<tenant>.sharepoint.com@<tenantId>


Nhận về: access_token

🅑 Bước 2 — Lấy RequestDigest

HTTP POST

https://<tenant>.sharepoint.com/sites/<site>/_api/contextinfo


Headers

Authorization: Bearer <access_token>
Accept: application/json;odata=verbose


Kết quả: trong d.GetContextWebInformation.FormDigestValue

🅒 Bước 3 — Gọi MoveFolderByPath

POST

https://<tenant>.sharepoint.com/sites/<site>/_api/SP.MoveCopyUtil.MoveFolderByPath()


Headers

{
  "Accept": "application/json;odata=verbose",
  "Content-Type": "application/json;odata=verbose",
  "Authorization": "Bearer <access_token>",
  "X-RequestDigest": "<FormDigestValue>"
}


Body

{
  "srcPath": { "DecodedUrl": "/sites/<site>/Shared Documents/OldFolder" },
  "destPath": { "DecodedUrl": "/sites/<site>/Shared Documents/NewFolder/OldFolder" },
  "options": { "KeepBoth": false, "ResetAuthorAndCreatedOnCopy": true }
}


✅ Lúc này SharePoint mới thực sự thực hiện việc di chuyển.

📌 Tóm gọn

Trong PAD, bạn phải tự cấp token + digest → nếu không, SharePoint trả về null và không move dù báo 200

Trong Cloud, hệ thống làm giúp bạn

📦 Nếu bạn muốn, mình có thể viết sẵn file .json Flow mẫu cho Power Automate Desktop gồm:

Bước lấy token

Bước lấy digest

Bước gọi MoveFolderByPath

Bạn có muốn mình tạo mẫu đó không? (copy vào PAD là chạy được luôn)


✅ Giải pháp thay thế hoạt động ổn định

Thay vì MoveFolderByPath(), hãy dùng chuỗi 2 REST API: Copy + Delete. Đây là cách phổ biến được Microsoft chính thức khuyến nghị khi không dùng CSOM:

📍 Bước 1 — Copy thư mục

POST

https://<tenant>.sharepoint.com/sites/<site>/_api/SP.MoveCopyUtil.CopyFolderByPath()


Headers

{
  "Accept": "application/json;odata=verbose",
  "Content-Type": "application/json;odata=verbose",
  "Authorization": "Bearer <access_token>",
  "X-RequestDigest": "<FormDigestValue>"
}


Body

{
  "srcPath": { "DecodedUrl": "/sites/<site>/Shared Documents/OldFolder" },
  "destPath": { "DecodedUrl": "/sites/<site>/Shared Documents/NewParent/OldFolder" },
  "options": { "KeepBoth": false, "ResetAuthorAndCreatedOnCopy": true }
}


📌 Đợi khi copy xong mới qua bước xóa.

📍 Bước 2 — Delete thư mục gốc

POST (vì DELETE không được hỗ trợ trực tiếp qua PAD invoke)

https://<tenant>.sharepoint.com/sites/<site>/_api/web/GetFolderByServerRelativeUrl('/sites/<site>/Shared Documents/OldFolder')


Headers

{
  "X-RequestDigest": "<FormDigestValue>",
  "IF-MATCH": "*",
  "X-HTTP-Method": "DELETE",
  "Authorization": "Bearer <access_token>"
}


📌 Đây là "trick" gọi DELETE trong PAD: dùng POST + header X-HTTP-Method: DELETE.
